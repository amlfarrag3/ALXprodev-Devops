#!/bin/bash

POKEMONS=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")
DATA_DIR="pokemon_data"
mkdir -p "$DATA_DIR"

PIDS=()

for name in "${POKEMONS[@]}"; do
    {
        echo "Fetching data for $name..."
        curl -s "https://pokeapi.co/api/v2/pokemon/${name,,}" -o "$DATA_DIR/${name}.json"
        if [ $? -eq 0 ]; then
            echo "Saved data to $DATA_DIR/${name}.json ✅"
        else
            echo "Failed to fetch data for $name ❌"
        fi
    } &
    PIDS+=($!)
done

# Optional: Timeout in seconds
TIMEOUT=10

# Monitor and kill slow processes
for pid in "${PIDS[@]}"; do
    (
        sleep $TIMEOUT
        if kill -0 "$pid" 2>/dev/null; then
            echo "⏱️ Process $pid took too long. Killing..."
            kill "$pid"
        fi
    ) &
done

# Wait for all original curl jobs to finish
wait

echo "✅ All fetch jobs completed."
